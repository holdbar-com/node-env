import { readdir, readFile } from 'node:fs/promises';
import { basename, dirname, join } from 'node:path';
export async function vote(path, file, extract) {
    const parent = dirname(path);
    const dir = basename(path);
    const entities = await readdir(parent, { withFileTypes: true });
    const contents = await Promise.all(entities
        .filter((entry) => entry.isDirectory() && entry.name !== dir)
        .map(async (entry) => {
        try {
            const content = await readFile(join(parent, entry.name, file), 'utf-8');
            return extract(content, entry.name);
        }
        catch (e) {
            return undefined;
        }
    }));
    const grouped = [
        ...contents.reduce((pv, value) => {
            pv.set(value, (pv.get(value) ?? 0) + 1);
            return pv;
        }, new Map()),
    ];
    if (grouped.length === 1) {
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        return grouped[0][0];
    }
    if (grouped.length > 3) {
        return;
    }
    const [first, second, third] = grouped.sort(([_, x], [__, y]) => y - x);
    if (!first || !second) {
        return;
    }
    if (third) {
        if (first[1] > 2 && second[1] === 1 && third[1] === 1) {
            return first[0];
        }
    }
    if (first[1] > 2 && second[1] === 1) {
        return first[0];
    }
    if (first[1] > 4 && second[1] === 2) {
        return first[0];
    }
    return undefined;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2libGluZ3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzaWJsaW5ncy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVwRCxNQUFNLENBQUMsS0FBSyxVQUFVLElBQUksQ0FDeEIsSUFBWSxFQUNaLElBQVksRUFDWixPQUE2QztJQUU3QyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FDaEMsUUFBUTtTQUNMLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDO1NBQzVELEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUU7UUFDbkIsSUFBSTtZQUNGLE1BQU0sT0FBTyxHQUFHLE1BQU0sUUFBUSxDQUM1QixJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQzlCLE9BQU8sQ0FDUixDQUFDO1lBQ0YsT0FBTyxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQWtCLENBQUM7U0FDdEQ7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLE9BQU8sU0FBMEIsQ0FBQztTQUNuQztJQUNILENBQUMsQ0FBQyxDQUNMLENBQUM7SUFDRixNQUFNLE9BQU8sR0FBRztRQUNkLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRTtZQUMvQixFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDeEMsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLEVBQUUsSUFBSSxHQUFHLEVBQWtDLENBQUM7S0FDOUMsQ0FBQztJQUNGLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDeEIsb0VBQW9FO1FBQ3BFLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3ZCO0lBQ0QsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUN0QixPQUFPO0tBQ1I7SUFDRCxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN4RSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ3JCLE9BQU87S0FDUjtJQUNELElBQUksS0FBSyxFQUFFO1FBQ1QsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNyRCxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNqQjtLQUNGO0lBQ0QsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDbkMsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDakI7SUFDRCxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNuQyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNqQjtJQUVELE9BQU8sU0FBUyxDQUFDO0FBQ25CLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZWFkZGlyLCByZWFkRmlsZSB9IGZyb20gJ25vZGU6ZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHsgYmFzZW5hbWUsIGRpcm5hbWUsIGpvaW4gfSBmcm9tICdub2RlOnBhdGgnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdm90ZTxUPihcbiAgcGF0aDogc3RyaW5nLFxuICBmaWxlOiBzdHJpbmcsXG4gIGV4dHJhY3Q6IChjb250ZW50OiBzdHJpbmcsIG5hbWU6IHN0cmluZykgPT4gVFxuKSB7XG4gIGNvbnN0IHBhcmVudCA9IGRpcm5hbWUocGF0aCk7XG4gIGNvbnN0IGRpciA9IGJhc2VuYW1lKHBhdGgpO1xuICBjb25zdCBlbnRpdGllcyA9IGF3YWl0IHJlYWRkaXIocGFyZW50LCB7IHdpdGhGaWxlVHlwZXM6IHRydWUgfSk7XG4gIGNvbnN0IGNvbnRlbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgZW50aXRpZXNcbiAgICAgIC5maWx0ZXIoKGVudHJ5KSA9PiBlbnRyeS5pc0RpcmVjdG9yeSgpICYmIGVudHJ5Lm5hbWUgIT09IGRpcilcbiAgICAgIC5tYXAoYXN5bmMgKGVudHJ5KSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHJlYWRGaWxlKFxuICAgICAgICAgICAgam9pbihwYXJlbnQsIGVudHJ5Lm5hbWUsIGZpbGUpLFxuICAgICAgICAgICAgJ3V0Zi04J1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGV4dHJhY3QoY29udGVudCwgZW50cnkubmFtZSkgYXMgVCB8IHVuZGVmaW5lZDtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQgYXMgVCB8IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgKTtcbiAgY29uc3QgZ3JvdXBlZCA9IFtcbiAgICAuLi5jb250ZW50cy5yZWR1Y2UoKHB2LCB2YWx1ZSkgPT4ge1xuICAgICAgcHYuc2V0KHZhbHVlLCAocHYuZ2V0KHZhbHVlKSA/PyAwKSArIDEpO1xuICAgICAgcmV0dXJuIHB2O1xuICAgIH0sIG5ldyBNYXA8QXdhaXRlZDxUPiB8IHVuZGVmaW5lZCwgbnVtYmVyPigpKSxcbiAgXTtcbiAgaWYgKGdyb3VwZWQubGVuZ3RoID09PSAxKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICByZXR1cm4gZ3JvdXBlZFswXSFbMF07XG4gIH1cbiAgaWYgKGdyb3VwZWQubGVuZ3RoID4gMykge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBbZmlyc3QsIHNlY29uZCwgdGhpcmRdID0gZ3JvdXBlZC5zb3J0KChbXywgeF0sIFtfXywgeV0pID0+IHkgLSB4KTtcbiAgaWYgKCFmaXJzdCB8fCAhc2Vjb25kKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICh0aGlyZCkge1xuICAgIGlmIChmaXJzdFsxXSA+IDIgJiYgc2Vjb25kWzFdID09PSAxICYmIHRoaXJkWzFdID09PSAxKSB7XG4gICAgICByZXR1cm4gZmlyc3RbMF07XG4gICAgfVxuICB9XG4gIGlmIChmaXJzdFsxXSA+IDIgJiYgc2Vjb25kWzFdID09PSAxKSB7XG4gICAgcmV0dXJuIGZpcnN0WzBdO1xuICB9XG4gIGlmIChmaXJzdFsxXSA+IDQgJiYgc2Vjb25kWzFdID09PSAyKSB7XG4gICAgcmV0dXJuIGZpcnN0WzBdO1xuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cbiJdfQ==